{"version":3,"file":"blackbox.js","names":["eventData","countPerPage","showPageCnt","$","eventUrl","axios","get","then","res","data","events","setTable","setPaging","catch","err","console","error","document","on","hasClass","parent","find","removeClass","addClass","Number","text","totalPage","Math","floor","length","id","attr","arrPages","each","idx","item","push","prevPage","_","min","nextPage","max","lastPage","pageNum","empty","filteredData","slice","sTbodyHtml","i","category","Event","Name","split","dtArray","StartTime","evnetId","Id","dateSplit","timeSplit","titleName","join","byte","DiskSpace","append","modalOpen","querySelectorAll","forEach","addEventListener","titles","getElementById","innerText","children","textContent","eventId","getAttribute","imgSrc","createElement","setAttribute","modal","currentPage","showAllIcon","hide","start","sPagesHtml","end","html","show"],"sources":["../../src/js/blackbox.js"],"sourcesContent":["let eventData = [];\r\n\r\nconst countPerPage = 13; // 페이지당 데이터 건수\r\nconst showPageCnt = 5; // 화면에 보일 페이지 번호 개수\r\n\r\n$(function() {\r\n  const eventUrl = \"http://192.168.0.51:8080/zm/api/events/index.json?user=admin&pass=hijacking1\";\r\n  axios.get(eventUrl)\r\n    .then(res => {\r\n\r\n      eventData = res.data.events;\r\n\r\n      // 데이터를 한 번에 가져와서 페이지별로 화면에 출력합니다.\r\n      setTable(1);\r\n      setPaging(1);\r\n    })\r\n    .catch(err => console.error(err))\r\n    .then(() => {\r\n      // finally\r\n    });\r\n\r\n  $(document).on('click', 'ul.pagination>li.page-item', function() {\r\n    if (!$(this).hasClass('active')) {\r\n      $(this).parent().find('li.active').removeClass('active');\r\n      $(this).addClass('active');\r\n\r\n      setTable(Number($(this).text()));\r\n    }\r\n  });\r\n\r\n  $(document).on('click', 'ul.pagination>li.move', function() {\r\n    const totalPage = Math.floor(eventData.length / countPerPage) + (eventData.length % countPerPage == 0 ? 0 : 1);\r\n    const id = $(this).attr('id');\r\n\r\n    if (id == 'first_page') {\r\n      setTable(1);\r\n      setPaging(1);\r\n    } else if (id == 'prev_page') {\r\n      let arrPages = [];\r\n      $('ul.pagination>li.page-item').each(function(idx, item) {\r\n        arrPages.push(Number($(this).text()));\r\n      });\r\n      \r\n      const prevPage = _.min(arrPages) - showPageCnt;\r\n      setTable(prevPage);\r\n      setPaging(prevPage);\r\n    } else if (id == 'next_page') {\r\n      let arrPages = [];\r\n      $('ul.pagination>li.page-item').each(function(idx, item) {\r\n        arrPages.push(Number($(this).text()));\r\n      });\r\n      \r\n      const nextPage = _.max(arrPages) + 1;\r\n      setTable(nextPage);\r\n      setPaging(nextPage);\r\n    } else if (id == 'last_page') {\r\n      const lastPage = Math.floor((totalPage - 1) / showPageCnt) * showPageCnt + 1;\r\n      setTable(lastPage);\r\n      setPaging(lastPage);\r\n    }\r\n  });\r\n});\r\n\r\n/**\r\n * 테이블에 데이터를 세팅합니다.\r\n */\r\nfunction setTable(pageNum) {\r\n  $('#table_body').empty();\r\n\r\n  // filtering data\r\n   const filteredData = eventData.slice((pageNum - 1) * countPerPage, pageNum * countPerPage);\r\n\r\n    // let fileName = \r\n\r\n  let sTbodyHtml = '';\r\n  for (let i = 0; i < filteredData.length; i++) {\r\n    let category = (filteredData[i].Event.Name).split(\"-\")[0];\r\n    let dtArray = (filteredData[i].Event.StartTime).split(\" \");\r\n    let evnetId = filteredData[i].Event.Id;\r\n    let dateSplit = dtArray[0].split(\"-\");\r\n    let timeSplit = dtArray[1].split(\":\");\r\n    let titleName = dateSplit.join(\"\")+\"_\"+timeSplit.join(\"\") + \"_record\";\r\n    let byte = Math.floor(filteredData[i].Event.DiskSpace/1024);\r\n    sTbodyHtml += '<tr class=\"modalVideo\" data-bs-toggle=\"modal\" data-bs-target=\"#videoModal\" data-value=\"'+evnetId+'\">';\r\n    sTbodyHtml += '  <td class=\"text-center\">' + category + '</td>';\r\n    sTbodyHtml += '  <td class=\"title-name\">' + titleName+evnetId+ '</td>';\r\n    sTbodyHtml += '  <td class=\"text-center\">' + dtArray[0] + '</td>';\r\n    sTbodyHtml += '  <td class=\"text-center\">' + dtArray[1] + '</td>';\r\n    sTbodyHtml += '  <td class=\"text-center\">' + byte +\" Kbyte\" + '</td>';\r\n    sTbodyHtml += '</tr>';\r\n \r\n    \r\n} \r\n  $('#table_body').append(sTbodyHtml);\r\n\r\n\r\n  \r\nlet modalOpen = document.querySelectorAll('tr.modalVideo');\r\nmodalOpen.forEach(function(item){\r\n    item.addEventListener('click',function(){\r\n        let titles = document.getElementById('videoModalLabel');\r\n        titles.innerText = item.children[1].textContent;\r\n        let eventId = item.getAttribute('data-value');\r\n        var imgSrc = document.createElement('img');\r\n        imgSrc.setAttribute('src',`http://192.168.0.51:8080/zm/cgi-bin/nph-zms?mode=jpeg&frame=1&replay=none&source=event&event=${eventId}&connkey=${eventId}&user=admin&pass=hijacking1`)\r\n        $('#recording').append(imgSrc);\r\n        $('#videoModal').modal('show');\r\n    })\r\n})\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n    \r\n/**\r\n * 페이징 정보를 세팅합니다.\r\n * @param {int} pageNum - Page Number\r\n */\r\nfunction setPaging(pageNum) {\r\n  const currentPage = pageNum;\r\n  const totalPage = Math.floor(eventData.length / countPerPage) + (eventData.length % countPerPage == 0 ? 0 : 1);\r\n  //console.log(currentPage, totalPage);\r\n\r\n  showAllIcon();\r\n\r\n  if (currentPage <= showPageCnt) {\r\n    $('#first_page').hide();\r\n    $('#prev_page').hide();\r\n  }\r\n  if (\r\n    totalPage <= showPageCnt ||\r\n    Math.floor((currentPage - 1) / showPageCnt) * showPageCnt + showPageCnt + 1 > totalPage\r\n  ) {\r\n    $('#next_page').hide();\r\n    $('#last_page').hide();\r\n  }\r\n\r\n  let start = Math.floor((currentPage - 1) / showPageCnt) * showPageCnt + 1;\r\n  let sPagesHtml = '';\r\n  for (const end = start + showPageCnt; start < end && start <= totalPage; start++) {\r\n    sPagesHtml += '<li class=\"page-item pages ' + (start == currentPage ? 'active' : '') + '\">' +'<a class=\"page-link\">' +start + '</a></li>';\r\n  }\r\n  $('ul.pagination').html(sPagesHtml);\r\n}\r\n\r\nfunction showAllIcon() {\r\n  $('#first_page').show();\r\n  $('#prev_page').show();\r\n  $('#next_page').show();\r\n  $('#last_page').show();\r\n}\r\n"],"mappings":"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"}